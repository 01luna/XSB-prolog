/* Shareware version */

:- compiler_options([ciao_directives]).

:- export make_cdf_dirty/1, make_cdf_clean/0,
	  cdf_update_list/1,  cdf_dont_use_cache/0, cdf_use_cache/0.

:- import assert_cdf/1, retractall_cdf/1 from usermod.

:- import cdf_flags/2, caching_cdf/1 from usermod.

cdf_dont_use_cache.
cdf_use_cache.

:- retractall(caching_cdf(_)),assert(caching_cdf(0)).

:- writeln('loading shareware cdfxj.P').

:- make_cdf_clean.

make_cdf_dirty(Name) :- 
	(Name == cdf -> 
	    true
	  ; 
	    assert(cdf_flags(dirty,Name)) ).
make_cdf_clean :- retractall(cdf_flags(dirty,_)).

:- comment(cdf_update_list/1, "cdf_update_list takes a list of
assert/retracts to stored CDF relations and executes them.  All
updates to any CDF relation should go through here.").

cdf_update_list(List) :-
	cdf_do_update_list(List).

cdf_do_update_list([]).
cdf_do_update_list([Term|Terms]) :-
	cdf_update_term(Term),
	cdf_do_update_list(Terms).

cdf_update_term(asserta(Term)) :-
	assert_cdf(Term).
cdf_update_term(retractall(Term)) :- 
	retractall_cdf(Term).

