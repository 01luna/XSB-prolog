
:- import 
     socket/1, socket_bind/2, socket_listen/2, socket_accept/2, 
     socket_connect/4, socket_flush/1 from socket.

:- import 
        file_write/2,
        file_write_canonical/2 
        from xsb_writ.

:- import
        file_read_canonical/3 from machine.

machine(sbproud8,'130.245.18.8').
machine(sbproud12,'130.245.18.12').
machine(compserv2,'130.245.1.58').
machine(compserv1,'130.245.1.44').
xsb_port(6020).

client :-
  writeln('started client...'),
  socket(Sockfd0),
  machine(compserv2,IPAddress),
  xsb_port(XSB_port),
  socket_connect(Sockfd0 ,XSB_port, IPAddress, Sockptr0),
  writeln('connected to server...'),

  socket(Sockfd1),
  socket_connect(Sockfd1, XSB_port, IPAddress, Sockptr1),

  client_loop(Sockptr0, Sockptr1).
%  client_loop(Sockptr0).


client_loop(Sockptr0, Sockptr1) :-  
%client_loop(Sockptr0) :-
  nl, write('pls input Goal (Type g(X). or h(X).  Type e. to finish):'), 
  read_canonical(Goal),
  (Goal == 'e' 
     -> !, true
   ;
    writeln(send(Goal)),
    file_write_canonical(Sockptr0, Goal), 
     file_write(Sockptr0, '. '),
     socket_flush(Sockptr0),
     repeat,
       file_read_canonical(Sockptr1, Answer, Psc),
%       file_read_canonical(Sockptr0, Answer, Psc),
       writeln(read_answer(Answer)),
       Psc = Psc,
       (Answer == 'end' 
          ->  client_loop(Sockptr0, Sockptr1)
	%     client_loop(Sockptr0)
        ;
          write(Answer), nl, 
          fail
       )
   ).
 


