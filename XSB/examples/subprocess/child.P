%% This is the program executed by child-XSB process spawned off by parent.P

:- import pipe2file/2 from file_io.
:- import file_read_line_atom/3 from file_io.

:- dynamic pipe/1, process/1.

?- pipe(P), pipe2file(P,F),
   %% pipe and process were asserted by child XSB before it consulted this file
   process(Pr),
   %% Acknowledge receipt of the pipe
   fmt_write("\nPipe %d received from Process %d\n", arg(P,Pr)),
   %% Get a message from the parent and print it to stdout
   file_read_line_atom(F, Line,_), write('Mesage was: '), writeln(Line).

%% Get the termination signal
?- read(X),
   (X=stop 
   -> writeln('Child: Termination signal received from parent, Bye'),
   halt).
