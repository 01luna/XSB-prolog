/* File:      interrupt1.P
** Author(s): Baoqiu Cui
** 
** $Id: interrupt1.P,v 1.2 1999-11-14 17:50:41 cbaoqiu Exp $
*/

:- import put_attributes/2, get_attributes/3 from machine.
:- import attv_unify/2 from machine.

test :-	test1.

% In LOCAL mode, verify_attributes/2 will be called twice: the first
% time is when `X = 5' is evaluated, the second time is when the trie
% code is executed to return an answer from the completed answer trie.

verify_attributes(Var, Value) :-
% 	get_attributes(Var, Atts, _),
% 	writeln('In verify_attributes/2:'),
% 	write('   Var''s attribute = '), writeln(Atts),
% 	write('   Value = '), writeln(Value),
	attv_unify(Var, Value).

test1 :-
	put_attributes(X, v(a)),
	p(X),
	write('First time: X = '), writeln(X),	% should be 5
	fail.
test1 :-
	put_attributes(X, v(a)),
	p(X),
	write('Second time: X = '), writeln(X).	% should be 5

% An instruction `check_interrupt' has to be just added before
% `new_answer_dealloc', because there is no more `call's before an
% answer is put into the answer table.  For example, in the following
% example, if we don't add `check_interrupt' before
% `new_answer_dealloc', verify_attributes/2 will be called after the
% WRONG answer p(X) (where X is still an attv) has been put into the
% answer table.

:- table p/1.

p(X) :- X = 5.

