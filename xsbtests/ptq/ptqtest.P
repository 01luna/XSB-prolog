:- op(200, xfy,[\]).    % lambda when bound var occurs only once
:- op(190, yfx,[@]).
:- op(150, fx,[^]).
:- op(150, fx,[*]).

:- tabled(s/5).
:- tabled(srev/5).

st(r14,T,(X,Te,T1))  :- T  = Te@ ^(X\T1).

test:- s(Q,W,E,R,T),numbervars(Q,0,_),write_canonical(Q),nl,fail.

s(T,Sa,Sb,A,B):- sc1(T,Sa,Sb,A,B).
s(T,Sa,Sb,A,B):-                  % s14
        s(T1,Sa,Sb1,A,B),
delete(sub(Te,X,_),Sb1,Sb), 
	write(Sb1),nl,
	write(Sb),nl,
	write(Te),nl,nl,
%not_occurs_in(X,Sb),
                st(r14,T,(X,Te,T1)).

srev(T,Sa,Sb,A,B):- sc2(T,Sa,Sb,A,B).
srev(T,Sa,Sb,A,B):-                  % s14
        srev(T1,Sa,Sb1,A,B),
delete(sub(Te,X,_),Sb1,Sb), 
	write(Sb1),nl,
	write(Sb),nl,
	write(Te),nl,nl,
%not_occurs_in(X,Sb),
                st(r14,T,(X,Te,T1)).

test1(Sb,Sb1,Te):-
	sc1(Q,W,Sb1,R,T),
	delete(sub(Te,X,_),Sb1,Sb).
	
delete(X,[X|L],L).
delete(X,[Y|L0],[Y|L1]) :- delete(X,L0,L1).

sc1(@(\(A,@(*(A),B)),^(@(\(C,\(D,@(*(C),^(\(E,@(@('date*',*(E)),*(D))))))),^(\(F,@(*(F),G)))))),[],'.'(sub(\(H,@(*(H),^(j))),B,m),'.'(sub(\(I,@(*(I),^(m))),G,f),[])),0,3).

sc2(foo,[],'.'(sub(\(H,@(*(H),^(j))),B,m),'.'(sub(\(I,@(*(I),^(m))),G,f),[])),0,3).
/*
sc1(@(\(A,@(*(A),B)),^(@(\(C,\(D,@(*(C),^(\(E,@(@('date*',*(E)),*(D))))))),^(\(F,@(*(F),^(m))))))),[],'.'(sub(\(G,@(*(G),^(j))),B,m),[]),0,3).
sc1(@(\(A,@(*(A),B)),^(\(C,@(\(D,@(*(D),^(m))),^(\(E,@(@(\(F,\(G,@(*(F),^(\(H,@(@('date*',*(H)),*(G))))))),^(\(I,@(*(I),E)))),C))))))),[],'.'(sub(\(J,@(*(J),^(j))),B,m),[]),0,3).
sc1(@(\(A,@(*(A),^(j))),^(@(\(B,\(C,@(*(B),^(\(D,@(@('date*',*(D)),*(C))))))),^(\(E,@(*(E),F)))))),[],'.'(sub(\(G,@(*(G),^(m))),F,f),[]),0,3).

sc1(@(\(A,@(*(A),^(j))),^(@(\(B,\(C,@(*(B),^(\(D,@(@('date*',*(D)),*(C))))))),^(\(E,@(*(E),^(m))))))),[],[],0,3).
sc1(@(\(A,@(*(A),^(j))),^(\(B,@(\(C,@(*(C),^(m))),^(\(D,@(@(\(E,\(F,@(*(E),^(\(G,@(@('date*',*(G)),*(F))))))),^(\(H,@(*(H),D)))),B))))))),[],[],0,3).
*/
